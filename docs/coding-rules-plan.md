Claude Codeのカスタムフックを用いて、指定されたコーディング規約（`interface`禁止、引数ルール）を強制化するための具体的かつ網羅的な実装計画です。

手順は大きく4つのフェーズに分かれます。

---

### フェーズ1：環境準備と設計
フックを実行するための土台を整えます。

1.  **実行ランタイムの選定**
    *   TypeScriptのAST（抽象構文木）を解析するため、`Node.js`（ts-node）または`Bun`が必要です。プロジェクト環境に合わせて決定します。
2.  **解析ライブラリの導入**
    *   正規表現ではなく、コードの構造を正確に理解するために `ts-morph` ライブラリをインストールします。
3.  **フック配置ディレクトリの作成**
    *   プロジェクトルートに `.claude/hooks/` ディレクトリを作成し、スクリプトの置き場所を確定します。

### フェーズ2：判定ロジックの実装（スクリプト作成）
「何をもって違反とするか」を定義するスクリプトを作成します。

1.  **入力データの受け取り処理**
    *   Claudeから渡されるJSON（標準入力）を読み込み、編集されたファイルパスを特定する処理を記述します。
2.  **解析対象のフィルタリング**
    *   `.ts`, `.tsx` などのTypeScriptファイル以外や、削除操作などは解析せずに終了（パス）するガード処理を入れます。
3.  **AST解析によるルール検証の実装**
    *   **ルールA：Interface禁止**
        *   ファイル内の `InterfaceDeclaration`（インターフェース宣言）を検索し、存在すればエラーと判定します。
    *   **ルールB：引数数の制限**
        *   関数宣言、メソッド宣言、変数に代入されたアロー関数を抽出します。
        *   引数が2つ以上あるものを検出します。
        *   **除外処理（重要）**: `map` や `filter` のコールバック関数など、開発者が引数構成を制御できない箇所はエラー対象から除外するロジックを組み込みます。
4.  **フィードバック生成（出力処理）**
    *   違反が見つかった場合、以下のJSONを標準出力する処理を作成します。
        *   `decision`: `"block"` （Claudeへの通知用）
        *   `reason`: 具体的な違反内容と修正指示（「interfaceをtypeに変更してください」「引数をオブジェクトにまとめてください」など）

### フェーズ3：Claude Codeへの統合
作成したスクリプトをClaude Codeが認識できるように設定します。

1.  **設定ファイルの編集**
    *   `.claude/settings.json` を開きます。
2.  **フックイベントの定義**
    *   `PostToolUse`（ツール実行後）イベントにフックを登録します。
    *   理由：ファイルの書き換えが完了し、完全な構文解析が可能になったタイミングでチェックするため。
3.  **マッチャー（適用範囲）の設定**
    *   `Edit`, `Write`, `MultiEdit` など、ファイル変更を伴うツールのみに反応するよう設定します。
4.  **実行コマンドの指定**
    *   フェーズ2で作成したスクリプトを実行するコマンドを記述します。
    *   `$CLAUDE_PROJECT_DIR` 変数を使用し、どの階層からでもパスが通るようにします。

### フェーズ4：動作検証とチューニング
意図通りに強制力が働くかテストします。

1.  **違反検出テスト**
    *   Claudeにわざと `interface` を使ったコードを書かせて、フックが拒否（Block）するか確認します。
    *   Claudeが拒否された理由を読み、自律的に `type` に修正して再提出するかを確認します。
2.  **除外ロジックのテスト**
    *   配列の `map` 処理などを書かせて、正当なコードが誤ってブロックされないか確認します。
3.  **エラーメッセージの調整**
    *   Claudeが一度で正しく修正できるよう、出力するエラーメッセージ（`reason`）の具体性を調整します。